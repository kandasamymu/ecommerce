<html>
  <head>
    <link rel="stylesheet" href="model_styles.css">
  </head>
  <body>
      <article>
        <section class ="Section row">
          <h2 class="section-title"><%= "#{t("header.welcome")} #{@current_user.first_name}!" %></h2>
          <% if !admin? %>
            <div style="margin-left:auto;">
              <%= form_tag request_create_orders_path, method: :post do %>
                <input type="hidden" name="client_cart_products" id="client_cart_products" value ="" />
                <button type="submit" class="button-small button-yellow" style="flex:"><%= t("products.check_out") %></button>
              <% end %>
            </div>
          <% end %>
        </section>
        <div class="row ">
          <h2  class="section-title purple-text"><%= t("products.product_list") %></h2>
          <% if admin? %>
            <%= form_tag view_create_product_path, method: :GET, :remote => true do %>
              <button type="submit" class="button-small">Create Products</button>
            <% end %>
          <% end %>
        </div>
      </article>

      <% if (@product_category && @product_category.errors.any?) || (@product && @product.errors.any?) %>
      <div id="error_explanation">
          <% @product_category.errors.full_messages.each do |msg| %>
            <p class="error_message"><%= msg %></p>
          <% end %>
          <% @product.errors.full_messages.each do |msg| %>
            <p class="error_message"><%= msg %></p>
          <% end %>
      </div>
      <% end %>
      <% flash.each do |type, msg| %>
        <% className = type == "Error" ? "error_message" : "success_message" %>
        <p class=<%= className %>><%= msg %></p>
      <% end %>
      <%= form_tag request_search_product_path, method: :PUT, class: "Section row", :remote => true do %>
          <div class ="input_box">
              <%= text_field_tag("search_term", value = nil, options = { class: "input_text ", placeholder: t("products.search_placeholder") }) %>
          </div>
          <button type="submit" class="button-small button-yellow" style="margin-left:20px"><%= t("products.search") %> </button>
      <% end %>
      <% @product_categories.each do |product_category| %>
        <% if product_category.products.size > 0 %>
          <section class="Section products_full_list">
            <div class="row row-bottom">
              <h3 id =<%= "#{product_category.id}_h2" %> class="Section_Category Green-Text "><%= product_category.name %></h3>
            </div>
            <%= render partial: "product_list_section", locals: { products: product_category.products } %>
          </section>
        <% end %>
      <% end %>
      <section class="Section hideElement" id="searched_products_list"></section>

      <div id="cart_products_from_db" data-source=<%= get_cart_orders_current_user.to_json %>></div>
      <div id="modal-window" class="modal modal--hidden">
        <div class="modal-content">
        </div>
      </div>
  </body>
  <script>
    $("#search_term")[0].addEventListener("keyup", (event)=>{
      if(event.target.value!='' ||  event.target.value.length < 3 ){
        $(".products_full_list").removeClass("hideElement");
        $("#searched_products_list").addClass("hideElement");
      }
    })
  </script>
</html>
